#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "üîç Running pre-commit coverage check..."

# Run your coverage script
powershell -ExecutionPolicy Bypass -File "./sg.com.shares.visionapi.Tests/RunTestsWithCoverage.ps1" -AllTests -Quick

# Check the exit code from PowerShell
exit_code=$?

if [ $exit_code -ne 0 ]; then
    echo ""
    echo "‚ùå COMMIT BLOCKED - Coverage check failed!"
    echo "   Your code coverage is below the required 80% threshold"
    echo "   Add more unit tests before committing"
    echo ""
    echo "   To bypass (NOT recommended): git commit --no-verify"
    exit 1
else
    echo ""
    echo "‚úÖ COMMIT ALLOWED - Coverage check passed!"
    exit 0
fi
